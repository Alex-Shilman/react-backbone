/*!
 * https://github.com/jhudson8/react-backbone v0.13.7;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=e:e(React,Backbone,_)}(function(e,t,n){function i(e){return e?n.isArray(e)?e:[e]:void 0}function o(e){return function(){return e?e:this.getModel?this.getModel():void 0}}function r(e){return e.getModelKey?e.getModelKey():e.props.name||e.props.key||e.props.ref}function a(e){if(context&&context.modelIndexErrors)return context.modelIndexErrors(e);if(Array.isArray(e)){var t={};return n.each(e,function(e){for(var n in e)t[n]=e[n]}),t}return e}function d(e,t){if(e.getModel){var n=r(e),i=e.getModel();if(i)return t(n,i)}}function l(e,t,o,r){var a,d,l=Array.isArray(e)?e:i(t.props[e]);if(l){for(var s=0;s<l.length;s++)a=l[s],d=o.replace("{key}",a),t.modelOn(d,n.bind(r,t),this);return l}}function s(e,t,n,i){var o=u(n),r=t[0],a=t[1],d=t[2];o[r]={type:e,ev:r,cb:a,ctx:d};var l=i||n.getModel();l&&n["on"===e?"listenTo":"listenToOnce"](l,r,a,d)}function u(e){var t=m("__modelEvents",e);return t||(t={},g({__modelEvents:t},e)),t}function c(e){for(var t,n=0;n<e.length;n++)t=e[n],"true"===t?t=!0:"false"===t?t=!1:t.match(/^[0-9]+$/)?t=parseInt(t):t.match(/^[0-9]+\.[0-9]+/)&&(t=parseFloat(t)),e[n]=t;return e}var f=t.xhrEventName,h=t.xhrCompleteEventName,v=t.xhrModelLoadingAttribute,m=e.mixins.getState,g=e.mixins.setState;e.mixins.getModelKey=r,e.mixins.modelIndexErrors=a,t.input=t.input||{};{var p=t.input.getModelValue=function(e){return d(e,function(e,t){return t.get(e)})};t.input.setModelValue=function(e,t,n){return d(e,function(e,i){return i.set(e,t,n)})}}if(e.mixins.add("modelAware",{getModel:function(e){return e=e||this.props,m("model",this)||m("collection",this)||e.model||e.collection},setModel:function(e,t){var i=this.getModel(),o=u(this);n.each(o,function(t){this.modelOff(t.ev,t.cb,t.ctx,i),s(t.type,[t.ev,t.cb,t.ctx],this,e)},this),t!==!0&&g("model",e)}},"state"),e.mixins.add("modelPopulate",{modelPopulate:function(){var e,i,o,a,d;n.each(arguments,function(r){r instanceof t.Model||n.isBoolean(r)?r?d=!0:a=r:n.isArray(r)?e=r:n.isFunction(r)?i=r:o=r}),n.isUndefined(a)&&this.getModel&&(a=this.getModel());var l={};e||(e=n.map(this.refs,function(e){return e}));var s={};if(n.each(e,function(e){if(e.getValue){var t=r(e);if(t){var i=e.getValue();l[t]=i}}else if(e.modelPopulate&&e.getModel){if(!a&&!d)return;var u=e.getModel();if(u){var c=e.modelPopulate(o,!0),f=s[u.cid]||{};n.extend(f,c),s[u.cid]={model:u,attr:f}}}}),a){var u=!0,c=s[a.cid];c||(c={model:a,attr:{}}),n.extend(c.attr,l),s[a.cid]=c;var f=n.defaults({validate:!0},o);n.each(s,function(e){var t=!e.model._validate(e.attr,f);u=!t&&u}),u&&(o=n.defaults({validate:!1},o),n.each(s,function(e){e.model.set(e.attr,o)})),i&&u&&i.call(this,a)}return l}},"modelAware"),e.mixins.add("modelValidator",{modelValidate:function(e,t){var n=this.getModel();return n&&n.validate?a(n.validate(e,t),this)||!1:void 0}},"modelAware"),n.each(["modelEvents","modelEventAware"],function(t){e.mixins.add(t,{getInitialState:function(){var e=this.getModel();return e&&(e.off&&e.on||(console.error("the model does not implement on/off functions - you will see problems"),console.log(e))),{}},componentWillReceiveProps:function(e){var t=this.getModel(),n=this.getModel(e);t!==n&&this.setModel(n,!0)},modelOn:function(){s("on",arguments,this)},modelOnce:function(){s("once",arguments,this)},modelOff:function(e,t,n,i){var r=u(this);delete r[e],this.stopListening(o(i),e,t,n)}},"modelAware","listen","events")}),e.mixins.add("modelChangeAware",{getInitialState:function(){return n.each(["change","reset","add","remove","sort"],function(e){this.modelOn(e,function(){this.deferUpdate()})},this),null}},"modelEventAware","deferUpdate"),e.mixins.add("modelXHRAware",{getInitialState:function(){this.modelOn(f,function(e,t){g({loading:!0},this);var n=this.getModel();t.on("success",function(){g({loading:n[v]},this)},this),t.on("error",function(e){g({loading:n[v],error:e},this)},this)});var e=this.getModel();return{loading:e&&e[v]}},componentDidMount:function(){var e=this.state,t=this.getModel();if(t){var n=t[v];n?(this.modelOnce(h,function(){g({loading:!1},this)}),e.loading||g({loading:!0},this)):e.loading&&g({loading:!1},this)}}},"modelEventAware"),e.mixins.add("modelInvalidAware",{getInitialState:function(){var e=r(this);return e&&this.modelOn("invalid",function(t,n){var i=a(n,this)||{},o=i&&i[e];o&&g({invalid:o},this)}),{}}},"modelEventAware"),e.mixins.add("modelLoadOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){e=l(e||"loadOn",this,f+":{key}",function(e){var t=this.getModel();g({loading:t[v]},this),e.on("complete",function(){g({loading:!1},this)},this)});var t=this.getModel();if(t){var n,i=t.loading;if(i)for(var o=function(){g({loading:!1},this)},r=0;r<i.length;r++){var a=e.indexOf(i[r].method);if(a>=0)return n=e[a],i[r].on("complete",o,this),{loading:t[v]}}}return{}},loadWhile:function(e){function t(t){var i=e[t];e[t]=function(){g({loading:!1},n),i&&i.apply(this,arguments)}}e=e||{};var n=this;return t("error"),t("success"),g({loading:!0},this),e}}},"modelEventAware"),e.mixins.add("modelUpdateOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){l(e||"updateOn",this,"{key}",function(){this.deferUpdate()})}}},"modelEventAware","deferUpdate"),e.events){e.events.mixin=e.events.mixin||t.Events;var M=/^model(\[.+\])?$/;e.events.handle(M,function(e,t){return{on:function(){if(!this.modelOn)throw new Error('use the "modelEvents" mixin instead of "events"');this.modelOn(e.path,t)},off:function(){}}});var x=e.events.specials;if(x){var y=["memoize","delay","defer","throttle","debounce","once","after","before"];n.each(y,function(e){x[e]=x[e]||function(t,i){return i=c(i),i.splice(0,0,t),n[e].apply(n,i)}})}}var O=function(t,i,o,r){return e.createClass(n.extend({mixins:["modelAware"],render:function(){var r={},a=p(this);return o?r.defaultChecked=a:r.defaultValue=a,e.DOM[t](n.extend(r,i,this.props),this.props.children)},getValue:function(){if(this.isMounted()){if(o){var e=this.getDOMNode();return e.checked&&(e.value||!0)||!1}return $(this.getDOMNode()).val()}},getDOMValue:function(){return this.isMounted()?$(this.getDOMNode()).val():void 0}},r))};t.input=t.input||{},n.defaults(t.input,{Text:O("input",{type:"text"}),TextArea:O("textarea"),Select:O("select",void 0,void 0),CheckBox:O("input",{type:"checkbox"},!0),RadioGroup:e.createClass({render:function(){var t=this.props;return t.ref="input",e.DOM[t.tag||"span"](t,t.children)},componentDidMount:function(){var e=p(this);if(e){var t='input[value="'+e.replace('"','\\"')+'"]',n=$(this.getDOMNode()).find(t);n.attr("checked","checked")}},getValue:function(){if(this.isMounted())for(var e='input[type="radio"]',t=$(this.getDOMNode()).find(e),n=0;n<t.length;n++)if(t[n].checked)return t[n].value},getDOMValue:function(){if(this.isMounted()){return $(this.getDOMNode()).val()}}})})});