/*!
 * https://github.com/jhudson8/react-backbone v0.14.3;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=e:e(React,Backbone,_)}(function(e,t,n){function i(e,t,n){return"collection"===e?t.getCollection(n):t.getModel(n)}function o(e){return e?n.isArray(e)?e:[e]:void 0}function r(e,t,n){return function(){return n?n:i(e,t)}}function a(e){return e.getModelKey?e.getModelKey():e.props.name||e.props.key||e.props.ref}function u(e,t){if(t&&t.modelIndexErrors)return t.modelIndexErrors(e);if(Array.isArray(e)){var i={};return n.each(e,function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])}),i}return e}function s(e,t){if(e.getModel){var n=a(e),i=e.getModel();if(i)return t(n,i)}}function l(e,t,i,r,a){var u,s,l=Array.isArray(t)?t:o(i.props[t]);if(l){for(var c=0;c<l.length;c++)u=l[c],s=r.replace("{key}",u),i[e+"On"](s,n.bind(a,i),this);return l}}function c(e,t,n,o,r){var a=d(o),u=n[0],s=n[1],l=n[2];a[u]={type:t,ev:u,cb:s,ctx:l};var c=r||i(e,o);c&&o["on"===t?"listenTo":"listenToOnce"](c,u,s,l)}function d(e){var t=m("__modelEvents",e);return t||(t={},x({__modelEvents:t},e)),t}function f(e,t,i){var o=m("loading",i);o||(o=[]),n.isArray(o)&&(o.push(e),x({loading:o},i),e.on("complete",function(){p(e,t,i)}))}function p(e,t,i){var o=m("loading",i);if(n.isArray(o)){for(var r=o.indexOf(e);r>=0;)o.splice(r,1),r=o.indexOf(e);o.length||x({loading:!1},i)}}function h(e,t,i){var o=t[g];o&&n.each(o,function(n){e&&n.method!==e||f(n,t,i)})}function v(e){for(var t,n=0;n<e.length;n++)t=e[n],"true"===t?t=!0:"false"===t?t=!1:t.match(/^[0-9]+$/)?t=parseInt(t):t.match(/^[0-9]+\.[0-9]+/)&&(t=parseFloat(t)),e[n]=t;return e}var y=t.xhrEventName,g=t.xhrModelLoadingAttribute,m=e.mixins.getState,x=e.mixins.setState;e.events.mixin=e.events.mixin||t.Events,e.mixins.getModelKey=a,e.mixins.modelIndexErrors=u,t.input=t.input||{};var M=t.input.getModelValue=function(e){return s(e,function(e,t){return t.get(e)})};t.input.setModelValue=function(e,t,n){return s(e,function(e,i){return i.set(e,t,n)})},n.each([{type:"model",capType:"Model",changeEvents:["change"]},{type:"collection",capType:"Collection",changeEvents:["add","remove","reset","sort"]}],function(t){var o={};o["get"+t.capType]=function(e){return e=e||this.props,m(t.type,this)||e[t.type]},o["set"+t.capType]=function(e,o){var r=i(t.type,this,this.props),a=d(this);n.each(a,function(n){this[t.type+"Off"](n.ev,n.cb,n.ctx,r),c(t.type,n.type,[n.ev,n.cb,n.ctx],this,e)},this),o!==!0&&x(t.type,e)},e.mixins.add(t.type+"Aware",o,"state");var a={getInitialState:function(){var e=i(t.type,this);return e&&(e.off&&e.on||(console.error("the model/collection does not implement on/off functions - you will see problems"),console.log(e))),{}},componentWillReceiveProps:function(e){var n=i(t.type,this),o=i(t.type,this,e);n!==o&&this["set"+t.capType](o,!0)}};a[t.type+"On"]=function(){c(t.type,"on",arguments,this)},a[t.type+"Once"]=function(){c(t.type,"once",arguments,this)},a[t.type+"Off"]=function(e,n,i,o){var a=d(this);delete a[e],this.stopListening(r(t.type,this,o),e,n,i)},e.mixins.add(t.type+"Events",a,t.type+"Aware","listen","events");var u={getInitialState:function(){n.each(t.changeEvents,function(e){this[t.type+"On"](e,function(){this.deferUpdate()},this)},this)}};e.mixins.add(t.type+"ChangeAware",u,t.type+"Events","listen","events","deferUpdate");var s={getInitialState:function(e,n){function o(e){var o=i(t.type,n);f(e,o,n)}return e?l(t.type,e,n,y+":{key}",o):n[t.type+"On"](y,function(e,t){o(t)}),{}},componentWillMount:function(e,o){var r=i(t.type,o);if(r)if(e){var a=n.isArray(e)?e:o.props[e];if(!a)return;n.isArray(a)||(a=[a]),n.each(a,function(e){h(e,r,o)})}else h(e,r,o)}},p={getInitialState:function(){return s.getInitialState(void 0,this)},componentWillMount:function(){return s.componentWillMount(void 0,this)}};e.mixins.add(t.type+"XHRAware",p,t.type+"Events");var v=function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){return s.getInitialState(e||"loadOn",this)},componentWillMount:function(){return s.componentWillMount(e||"loadOn",this)}}};e.mixins.add(t.type+"LoadOn",v,t.type+"Events");var g=function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){l(t.type,e||"updateOn",this,"{key}",function(){this.deferUpdate()})}}};e.mixins.add(t.type+"UpdateOn",g,t.type+"Events","deferUpdate");var M=new RegExp("^"+t.type+"(\\[.+\\])?$");e.events.handle(M,function(e,n){return{on:function(){if(!this[t.type+"On"])throw new Error("use the "+t.type+' "Events" mixin instead of "events"');this[t.type+"On"](e.path,n)},off:function(){}}})}),n.each({XHRAware:"XHRAware",changeAware:"ChangeAware",loadOn:"LoadOn",updateOn:"UpdateOn"},function(t,n){e.mixins.alias(n,"model"+t,"collection"+t)}),e.mixins.add("modelPopulate",{modelPopulate:function(){var e,i,o,r,u;n.each(arguments,function(a){a instanceof t.Model?r=a:n.isBoolean(a)?(u=!0,r=!1):n.isArray(a)?e=a:n.isFunction(a)?i=a:o=a}),n.isUndefined(r)&&this.getModel&&(r=this.getModel());var s={};return e||(e=n.map(this.refs,function(e){return e})),n.each(e,function(e){if(e.getValue){var t=a(e);if(t){var i=e.getValue();s[t]=i}}else if(e.modelPopulate&&e.getModel){if(!r&&!u)return;var l=e.getModel(),c=r||o&&o.populateModel;if(l===c){var d=e.modelPopulate(n.extend({populateModel:c},o),!0);n.defaults(s,d)}}}),r&&r.set(s,{validate:!0})&&i.call(this,r),s}},"modelAware"),e.mixins.add("loadWhile",{loadWhile:function(e){function t(t){var i=e[t];e[t]=function(){x({loading:!1},n),i&&i.apply(this,arguments)}}e=e||{};var n=this;return t("error"),t("success"),x({loading:!0},this),e}}),e.mixins.add("modelValidator",{modelValidate:function(e,t){var n=this.getModel();return n&&n.validate?u(n.validate(e,t),this)||!1:void 0}},"modelAware"),e.mixins.add("modelInvalidAware",{getInitialState:function(){var e=a(this);return e&&this.modelOn("invalid",function(t,n){var i=u(n,this)||{},o=i&&i[e];o&&x({invalid:o},this)}),{}}},"modelEvents");var O=e.events.specials;if(O){var A=["memoize","delay","defer","throttle","debounce","once","after","before"];n.each(A,function(e){O[e]=O[e]||function(t,i){return i=v(i),i.splice(0,0,t),n[e].apply(n,i)}})}var E=function(t,i,o,r){return e.createClass(n.extend({mixins:["modelAware"],render:function(){var r={},a=M(this);return o?r.defaultChecked=a:r.defaultValue=a,e.DOM[t](n.extend(r,i,this.props),this.props.children)},getValue:function(){if(this.isMounted()){if(o){var e=this.getDOMNode();return e.checked&&(e.value||!0)||!1}return $(this.getDOMNode()).val()}},getDOMValue:function(){return this.isMounted()?$(this.getDOMNode()).val():void 0}},r))};t.input=t.input||{},n.defaults(t.input,{Text:E("input",{type:"text"}),TextArea:E("textarea"),Select:E("select",void 0,void 0),CheckBox:E("input",{type:"checkbox"},!0),RadioGroup:e.createClass({render:function(){var t=this.props;return t.ref="input",e.DOM[t.tag||"span"](t,t.children)},componentDidMount:function(){var e=M(this);if(e){var t='input[value="'+e.replace('"','\\"')+'"]',n=$(this.getDOMNode()).find(t);n.attr("checked","checked")}},getValue:function(){if(this.isMounted())for(var e='input[type="radio"]',t=$(this.getDOMNode()).find(e),n=0;n<t.length;n++)if(t[n].checked)return t[n].value},getDOMValue:function(){return this.isMounted()?$(this.getDOMNode()).val():void 0}})})});