/*!
 * https://github.com/jhudson8/react-backbone v0.23.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=e:e(React,Backbone,_,$)}(function(e,t,n,i){function o(){var t=n.toArray(arguments);n.isString(t)?t[0]=x+t[0]:t.name=x+t.name,e.mixins.add.apply(e.mixins,t)}function r(e){return e.getModel?e.getModel():void 0}function a(e,t,n,i){return"collection"===e?t.getCollection(n,i):t.getModel(n,i)}function s(e){return e?n.isArray(e)?e:[e]:void 0}function u(e,t,n){return function(){return n?n:a(e,t)}}function c(e){return e.getModelKey?e.getModelKey():e.props.name||e.props.key||e.props.ref}function l(e,t){if(t&&t.modelIndexErrors)return t.modelIndexErrors(e);if(Array.isArray(e)){var i={};return n.each(e,function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])}),i}return e}function d(e,t){var n=r(e);if(n){var i=c(e);return t(i,n)}}function f(e,t,i,o,r){var a,u,c=Array.isArray(t)?t:s(i.props[t]);if(c){for(var l=0;l<c.length;l++)a=c[l],u=o.replace("{key}",a),i[e+"On"](u,n.bind(r,i),this);return c}}function p(e,t,n,i,o){function r(e){i["on"===t?"listenTo":"listenToOnce"](e,u,c,l)}var s=v(e,i),u=n[0],c=n[1],l=n[2];s[u]={type:t,ev:u,cb:c,ctx:l},i.isMounted()&&(o?r(o):a(e,i,r))}function h(e,t,i,o,r){if(t!==i||r){var a=v(e,o);t&&(o.trigger(e+":unbind",i),n.each(a,function(e){this.stopListening(t,e.ev,e.cb,e.ctx)},o)),i&&(o.trigger(e+":bind",i),n.each(a,function(t){p(e,t.type,[t.ev,t.cb,t.ctx],this,i,r)},o))}}function v(e,t){var n="__"+e+"Events",i=b(n,t);if(!i){i={};var o={};o[n]=i,w(o,t)}return i}function g(e,t,i){var o=b("loading",i),r=o&&o.length;o||(o=[]),n.isArray(o)&&(o.push(e),r||w({loading:o},i),e.on("complete",function(){y(e,t,i)}))}function y(e,t,i){var o=b("loading",i);if(n.isArray(o)){for(var r=o.indexOf(e);r>=0;)o.splice(r,1),r=o.indexOf(e);o.length||w({loading:!1},i)}}function m(e,t,i){var o=t[A];o&&n.each(o,function(n){e&&n.method!==e||g(n,t,i)})}function M(e){var t=e.props,i=t.bind;if(i&&"false"!==i){var o=n.isString(i)||i===!0?{twoWayBinding:!0}:i;return function(t){var i=e.getModel(),r=c(e),a={};if(a[r]=e.getValue(),i&&r)if(o.validateField){var s=i.validate(a,o);s?i.trigger("invalid",i,s,n.extend(o,{validationError:s})):i.set(a,o)}else i.set(a,o);e.props.onChange&&e.props.onChange(t)}}return t.onChange}var x="react-backbone.",O=t.xhrEventName,A=t.xhrModelLoadingAttribute,b=e.mixins.getState,w=e.mixins.setState,D=e.reactBackboneDebugWarnings;n.isUndefined(D)&&(D=!0),e.events.mixin=e.events.mixin||t.Events,e.mixins.getModelKey=c,e.mixins.modelIndexErrors=l,t.input=t.input||{};var E=t.input.getModelValue=function(e){return d(e,function(e,t){return t.get(e)})};t.input.setModelValue=function(e,t,n){return d(e,function(e,i){return i.set(e,t,n)})},n.each([{type:"model",defaultParams:[["model"]],capType:"Model",changeEvents:["change"]},{type:"collection",defaultParams:[["collection"]],capType:"Collection",changeEvents:["add","remove","reset","sort"]}],function(i){var r="get"+i.capType,s=function(e){var t={};return t[r]=function(t,n){var o=e,r=!!n;n=n||this.props,o&&0!==o.length||(o=i.defaultParams);for(var a,s,u=0;u<o.length;u++){s=o[u];for(var c=0;c<s.length;c++){var l=s[c],d=b(l,this)||n[l];if(d){if(a=a||d,!t)return d;t.call(this,d,l)}else r&&t&&l&&t.call(this,void 0,l)}}return a},t["set"+i.capType]=function(e,t){t=t||i.type;var n,o={};this["get"+i.capType](function(e,i){i===t&&(n=e)}),h(i.type,n,n,this),o[t]=e,this.trigger(i.type+":set",e,t,n)},t};o({name:i.type+"Aware",initiatedOnce:!0},s,"state");var c={getInitialState:function(){return a(i.type,this,function(e,t){(D&&!e.off||!e.on)&&(console.error("props."+t+" does not implement on/off functions - you will see event binding problems (object logged to console below)"),console.log(e))}),{}},componentWillReceiveProps:function(e){a(i.type,this,function(e,t){var n=this.props[t];h(i.type,n,e,this),this.trigger(i.type+":set",e,t,n)},e)},componentDidMount:function(){a(i.type,this,function(e,t){var n=this.props[t];h(i.type,n,e,this,!0)},this.props)}};c[i.type+"On"]=function(){p(i.type,"on",arguments,this)},c[i.type+"Once"]=function(){p(i.type,"once",arguments,this)},c[i.type+"Off"]=function(e,t,n,o){var r=v(i.type,this);delete r[e],this.stopListening(u(i.type,this,o),e,t,n)},o(i.type+"Events",c,i.type+"Aware","listen","events");var l={getInitialState:function(){n.each(i.changeEvents,function(e){this[i.type+"On"](e,function(e,t){t&&t.twoWayBinding||this.deferUpdate()},this)},this)}};o(i.type+"ChangeAware",l,i.type+"Events","listen","events","deferUpdate");var d={getInitialState:function(){function e(e){e.whenFetched(function(){})}this.on(i.type+":bind",e),this["get"+i.capType](e)}};o(i.type+"Fetch",d,i.type+"Events");var y={getInitialState:function(e,n){function o(e){a(i.type,n,function(t){g(e,t,n)})}return e?f(i.type,e,n,O+":{key}",o):n[i.type+"On"](O,function(e){"collection"===i.type&&e.model instanceof t.Model||o(e)}),{}},componentDidMount:function(e,t){function o(i){if(e){var o=n.isArray(e)?e:t.props[e];if(!o)return;n.isArray(o)||(o=[o]),n.each(o,function(e){m(e,i,t)})}else m(e,i,t)}a(i.type,t,function(e){o(e)}),t.on(i.type+":set",function(e){o(e)})}},M={getInitialState:function(){return y.getInitialState(void 0,this)},componentDidMount:function(){return y.componentDidMount(void 0,this)}};o(i.type+"XHRAware",M,i.type+"Events");var x=function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){return y.getInitialState(e||"loadOn",this)},componentDidMount:function(){return y.componentDidMount(e||"loadOn",this)}}};o(i.type+"LoadOn",x,i.type+"Events");var A=function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){f(i.type,e||"updateOn",this,"{key}",function(){this.deferUpdate()})}}};o(i.type+"UpdateOn",A,i.type+"Events","deferUpdate");var w=new RegExp("^"+i.type+"(\\[.+\\])?$");e.events.handle(w,function(e,t){return{on:function(){if(!this[i.type+"On"])throw new Error("use the "+i.type+' "Events" mixin instead of "events"');this[i.type+"On"](e.path,t)},off:function(){}}})}),n.each(["XHRAware","ChangeAware","LoadOn","UpdateOn"],function(t){e.mixins.alias("backbone"+t,"model"+t,"collection"+t)}),o("modelPopulate",{modelPopulate:function(){var e,i,o,a,s;n.each(arguments,function(r){r instanceof t.Model?a=r:n.isBoolean(r)?(s=!0,a=!1):n.isArray(r)?e=r:n.isFunction(r)?i=r:o=r}),n.isUndefined(a)&&(a=r(this));var u={};return e||(e=n.map(this.refs,function(e){return e})),n.each(e,function(e){if(e.getValue){var t=c(e);if(t){var i=e.getValue();u[t]=i}}else if(e.modelPopulate&&e.getModels){if(!a&&!s)return;var l=r(e),d=a||o&&o.populateModel;if(l===d){var f=e.modelPopulate(n.extend({populateModel:d},o),!0);n.defaults(u,f)}}}),a&&a.set(u,{validate:!0})&&i&&i.call(this,a),u}},"modelAware"),o("loadWhile",{loadWhile:function(e){function t(t){var i=e[t];e[t]=function(){w({loading:!1},n),i&&i.apply(this,arguments)}}e=e||{};var n=this;return t("error"),t("success"),w({loading:!0},this),e}}),o("modelValidator",{modelValidate:function(e,t){var n=r(this);return n&&n.validate?l(n.validate(e,t),this)||!1:void 0}},"modelAware"),o("modelInvalidAware",{getInitialState:function(){var e=c(this);return e&&(this.modelOn("invalid",function(t,n){var i=l(n,this)||{},o=i&&i[e];o&&w({invalid:o},this)}),this.modelOn("change:"+e,function(){w({invalid:void 0},this)})),{}}},"modelEvents");var k=e.events.specials;if(k){var S=["memoize","delay","defer","throttle","debounce","once","after","before"];n.each(S,function(e){k[e]=k[e]||function(t,i){return i.splice(0,0,t),n[e].apply(n,i)}})}var I=function(t,o,r,a){return e.createClass(n.extend({mixins:["modelAware"],render:function(){var i={},a=E(this);return r?i.defaultChecked=a:i.defaultValue=a,e.DOM[t](n.extend(i,o,this.props,{onChange:M(this)}),this.props.children)},getValue:function(){if(this.isMounted()){if(r){var e=this.getDOMNode();return e.checked&&(e.value||!0)||!1}return i(this.getDOMNode()).val()}},getDOMValue:function(){return this.isMounted()?i(this.getDOMNode()).val():void 0}},a))};t.input=t.input||{},n.defaults(t.input,{Text:I("input",{type:"text"}),TextArea:I("textarea"),Select:I("select",void 0,void 0),CheckBox:I("input",{type:"checkbox"},!0),RadioGroup:e.createClass({mixins:["modelAware"],render:function(){var t=n.clone(this.props);return t.ref="input",e.DOM[t.tag||"span"](t,t.children)},componentDidMount:function(){var e=E(this);if(e){var t='input[value="'+e.replace('"','\\"')+'"]',n=i(this.getDOMNode()).find(t);n.attr("checked","checked")}this.state||(this.state={});var o=this.state.changeHandler=M(this);o&&i(this.getDOMNode()).on("change","input",o)},componentWillUnmount:function(){var e=this.state&&this.state.changeHandler;e&&i(this.getDOMNode()).off("change",e)},getValue:function(){if(this.isMounted())for(var e='input[type="radio"]',t=i(this.getDOMNode()).find(e),n=0;n<t.length;n++)if(t[n].checked)return t[n].value},getDOMValue:function(){return this.isMounted()?i(this.getDOMNode()).val():void 0}})})});