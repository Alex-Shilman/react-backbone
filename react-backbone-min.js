/*!
 * https://github.com/jhudson8/react-backbone v0.26.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(t){"function"==typeof define&&define.amd?define([],function(){return t}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=t:t(React,Backbone,_)}(function(t,e,n){function i(){var e=n.toArray(arguments);n.isString(e)?e[0]=O+e[0]:e.name=O+e.name,t.mixins.add.apply(t.mixins,e)}function o(t){return t.getModel?t.getModel():void 0}function r(t,e,n,i){return t===W?e.getCollection(n,i):e.getModel(n,i)}function a(t){return t?n.isArray(t)?t:[t]:void 0}function u(t,e,n){return function(){return n?n:r(t,e)}}function s(t){return t.getModelKey?t.getModelKey():t.props.name||t.props.key||t.props.ref}function c(t,e){if(e&&e.modelIndexErrors)return e.modelIndexErrors(t);if(Array.isArray(t)){var i={};return n.each(t,function(t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e])}),i}return t}function l(t,e){var n=o(t);if(n){var i=s(t);return e(i,n)}}function d(t,e,i,o,r){var u=e;n.isString(u)&&(u=a(i.props[u]));var s=n.isArray(u);if(n.each(u,function(e,a){s&&(a=e,e=void 0);var u;u=n.isString(o)?o.replace("{key}",a):o(a),i[t+C](u,n.bind(r,{key:a,value:e}),this)},this),!u&&n.isFunction(o)){var c=o(void 0);c&&i[t+C](c,n.bind(r,{}),this)}return u}function f(t,e,n,i,o){function a(t){i["on"===e?"listenTo":"listenToOnce"](t,s,c,l)}var u=h(t,i),s=n[0],c=n[1],l=n[2];u[s]={type:e,ev:s,cb:c,ctx:l},u.__bound&&(o?a(o):r(t,i,a))}function p(t){function e(t,e){u&&t===e||(u&&t&&(o.trigger(i+":unbind",e),n.each(a,function(e){e&&e!==!0&&this.stopListening(t,e.ev,e.cb,e.ctx)},o)),e&&(o.trigger(i+":bind",e),n.each(a,function(t){t&&t!==!0&&f(i,t.type,[t.ev,t.cb,t.ctx],this,e)},o)))}var i=t.type,o=t.context,a=h(i,o),u=a.__bound;a.__bound=!0,r(i,o,function(t,n){var o=this.props[n];e(o,t),o!==t&&o&&this.trigger(i+":set",t,n,o)},t.props||o.props)}function h(t,e){var n="__"+t+_,i=S(n,e);if(!i){i={};var o={};o[n]=i,E(o,e)}return i}function v(t,e,i,o){var r=S(e,o),a=r&&r.length;if(r||(r=[]),n.isArray(r)){if(r.push(t),!a){var u={};u[e]=r,E(u,o)}t.on("complete",function(){g(t,e,i,o)})}}function g(t,e,i,o){var r=S(e,o);if(n.isArray(r)){for(var a=r.indexOf(t);a>=0;)r.splice(a,1),a=r.indexOf(t);if(!r.length){var u={};u[e]=void 0,E(u,o)}}}function y(t,e,i,o){var r=i[w];r&&n.each(r,function(n){t&&t!==T&&n.method!==t||v(n,e,i,o)})}function m(t){return t.getDOMNode()}function x(t){return m(t).value}function M(t,e,n,i){for(var o=t.getDOMNode(),r=o.getElementsByTagName(e),a=[],u=0;u<r.length;u++)r[u][n]===i&&a.push(r[u]);return a}function b(t){var e=t.props,i=e.bind;if(i&&"false"!==i){var o=n.isString(i)||i===!0?{twoWayBinding:!0}:i;return function(e){var i=t.getModel(),r=s(t),a={};if(a[r]=t.getValue(),i&&r)if(o.validateField){var u=i.validate(a,o);u?i.trigger("invalid",i,u,n.extend(o,{validationError:u})):i.set(a,o)}else i.set(a,o);t.props.onChange&&t.props.onChange(e)}}return e.onChange}var O="react-backbone.",A=e.xhrEventName,w=e.xhrModelLoadingAttribute,S=t.mixins.getState,E=t.mixins.setState,I=t.reactBackboneDebugWarnings,k=e[e.xhrGlobalAttribute],D="loading",C="On",_="Events",V="events",P="change",T="all",K="listen",U="deferUpdate",W="collection",B="model";n.isUndefined(I)&&(I=!0),t.events.mixin=t.events.mixin||e.Events,t.mixins.getModelKey=s,t.mixins.modelIndexErrors=c,e.input=e.input||{};var L=e.input.getModelValue=function(t){return l(t,function(t,e){return e.get(t)})};e.input.setModelValue=function(t,e,n){return l(t,function(t,i){return i.set(t,e,n)})},n.each([{type:B,defaultParams:[[B]],capType:"Model",changeEvents:[P],cachedKey:"__cachedModels"},{type:W,defaultParams:[[W]],capType:"Collection",changeEvents:[P,"add","remove","reset","sort"],cachedKey:"__cachedCollections"}],function(o){var a="get"+o.capType,s=function(t){var e={getInitialState:function(){return{}},componentWillReceiveProps:function(){this.state[o.cachedKey]=void 0}};return e[a]=function(e,i){var r=!i&&this.state&&this.state[o.cachedKey];if(!r){r={};var a=t,u=!!i;i=i||this.props,a&&0!==a.length||(a=o.defaultParams);for(var s,c=0;c<a.length;c++){s=a[c];for(var l=0;l<s.length;l++){var d=s[l],f=S(d,this)||i[d];f?r[d]=f:u&&e&&d&&e.call(this,void 0,d)}}!u&&this.state&&(this.state[o.cachedKey]=r)}var p;return n.each(r,function(t,n){p=p||t,e&&e.call(this,t,n)},this),p},e};i({name:o.type+"Aware",initiatedOnce:!0},s,"state");var c={getInitialState:function(){return r(o.type,this,function(t,e){(I&&!t.off||!t.on)&&(console.error("props."+e+" does not implement on/off functions - you will see event binding problems (object logged to console below)"),console.log(t))}),null},componentWillReceiveProps:function(t){p({context:this,props:t,type:o.type})},componentDidMount:function(){p({context:this,type:o.type})}};c[o.type+C]=function(){f(o.type,"on",arguments,this)},c[o.type+"Once"]=function(){f(o.type,"once",arguments,this)},c[o.type+"Off"]=function(t,e,n,i){var r=h(o.type,this);delete r[t],this.stopListening(u(o.type,this,i),t,e,n)},i(o.type+_,c,o.type+"Aware",K,V);var l={getInitialState:function(){n.each(o.changeEvents,function(t){this[o.type+C](t,function(t,e){e&&e.twoWayBinding||this.deferUpdate()},this)},this)}};i(o.type+"ChangeAware",l,o.type+_,K,V,U);var g={getInitialState:function(){function t(t){t.whenFetched(function(){})}this.on(o.type+":bind",t),this["get"+o.capType](t)}};i(o.type+"Fetch",g,o.type+_);var m={getInitialState:function(t,n){function i(t){o.type===W&&t.model instanceof e.Model||v(t,this.value||D,t.model,n)}var r=function(t){return t&&t!==T?A+":"+t:A};return d(o.type,t,n,r,i),null},componentDidMount:function(t,e){function i(i){t?n.each(a,function(t,n){u&&(n=t,t=D),y(n,t,i,e)}):y(T,D,i,e)}var a=t;n.isString(a)&&(a=[a]);var u=n.isArray(t);r(o.type,e,function(t){i(t)}),e.on(o.type+":set",function(t){i(t)})}},x=function(){var t;return 0===arguments.length?t=void 0:1===arguments.length&&(t=arguments[0]),{getInitialState:function(){return m.getInitialState(t,this)},componentDidMount:function(){return m.componentDidMount(t,this)}}};i(o.type+"XHRAware",x,o.type+_);var M={getInitialState:function(){return m.getInitialState(this.props.loadOn,this)},componentDidMount:function(){return m.componentDidMount(this.props.loadOn,this)}};i(o.type+"LoadOn",M,o.type+_);var b=function(){var t=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){var e=this;d(o.type,t||"updateOn",this,"{key}",function(){e.deferUpdate()})}}};i(o.type+"UpdateOn",b,o.type+_,U);var O=new RegExp("^"+o.type+"(\\[.+\\])?$");t.events.handle(O,function(t,e){return{on:function(){if(!this[o.type+C])throw new Error("use the "+o.type+' "Events" mixin instead of "events"');this[o.type+C](t.path,e)},off:function(){}}})}),n.each(["XHRAware","ChangeAware","LoadOn","UpdateOn"],function(e){t.mixins.alias("backbone"+e,B+e,W+e)}),i("modelPopulate",{modelPopulate:function(){var t,i,r,a,u;n.each(arguments,function(o){o instanceof e.Model?a=o:n.isBoolean(o)?(u=!0,a=!1):n.isArray(o)?t=o:n.isFunction(o)?i=o:r=o}),n.isUndefined(a)&&(a=o(this));var c={};return t||(t=n.map(this.refs,function(t){return t})),n.each(t,function(t){if(t.getValue){var e=s(t);if(e){var i=t.getValue();c[e]=i}}else if(t.modelPopulate&&t.getModels){if(!a&&!u)return;var l=o(t),d=a||r&&r.populateModel;if(l===d){var f=t.modelPopulate(n.extend({populateModel:d},r),!0);n.defaults(c,f)}}}),a&&(a.set(c,{validate:!0})?i&&i.call(this,a):r&&r.onInvalid&&r.onInvalid.call(this,c)),c}},"modelAware"),i("loadWhile",{loadWhile:function(t,e){function n(t){var n=S(e,i);n||(n=[]),n.push(t),t.on("complete",function(){if(n=S(e,i),n.splice(n.indexOf(t,1)),!n.length){var o={};o[e]=void 0,E(o,i)}});var o={};o[e]=n,E(o,i)}e=e||D;var i=this;k.on(A,n);try{t.call(this)}finally{k.off(A,n)}}}),i("modelValidator",{modelValidate:function(t,e){var n=o(this);return n&&n.validate?c(n.validate(t,e),this)||!1:void 0}},"modelAware"),i("modelInvalidAware",{getInitialState:function(){var t=s(this);return t&&(this.modelOn("invalid",function(e,n){var i=c(n,this)||{},o=i&&i[t];o&&E({invalid:o},this)}),this.modelOn("change:"+t,function(){E({invalid:void 0},this)})),null}},"modelEvents");var R=t.events.specials;if(R){var F=["memoize","delay","defer","throttle","debounce","once","after","before"];n.each(F,function(t){R[t]=R[t]||function(e,i){return i.splice(0,0,e),n[t].apply(n,i)}})}var N=function(e,i,o,r){return t.createClass(n.extend({mixins:["modelAware"],render:function(){var r={},a=L(this);return o?r.defaultChecked=a:r.defaultValue=a,t.DOM[e](n.extend(r,i,this.props,{onChange:b(this)}),this.props.children)},getValue:function(){if(this.isMounted()){if(o){var t=this.getDOMNode();return t.checked&&(t.value||!0)||!1}return x(this)}},getDOMValue:function(){return this.isMounted()?x(this):void 0}},r))};e.input=e.input||{},n.defaults(e.input,{Text:N("input",{type:"text"}),TextArea:N("textarea"),Select:N("select",void 0,void 0),CheckBox:N("input",{type:"checkbox"},!0),RadioGroup:t.createClass({mixins:["modelAware"],render:function(){var e=n.clone(this.props);return e.ref="input",t.DOM[e.tag||"span"](e,e.children)},componentDidMount:function(){var t=L(this);if(t){var e=M(this,"input","value",t.replace('"','\\"'))[0];e&&(e.checked="checked")}this.state||(this.state={});var n=this.state.changeHandler=b(this);n&&m(this).addEventListener(P,n)},componentWillUnmount:function(){var t=this.state&&this.state.changeHandler;t&&m(this).removeEventListener(P,t)},getValue:function(){if(this.isMounted())for(var t=M(this,"input","type","radio"),e=0;e<t.length;e++)if(t[e].checked)return t[e].value},getDOMValue:function(){return this.isMounted()?x(this):void 0}})})});