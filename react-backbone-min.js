/*!
 * https://github.com/jhudson8/react-backbone v0.13.1;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=e:e(React,Backbone,_)}(function(e,t,n){function i(e){return e?n.isArray(e)?e:[e]:void 0}function o(e){return function(){return e?e:this.getModel?this.getModel():void 0}}function r(e){return e.getModelKey?e.getModelKey():e.props.key||e.props.ref||e.props.name}function a(e,t){if(e.getModel){var n=r(e),i=e.getModel();if(i)return t(n,i)}}function d(e,t,o,r){var a,d,l=Array.isArray(e)?e:i(t.props[e]);if(l){for(var s=0;s<l.length;s++)a=l[s],d=o.replace("{key}",a),t.modelOn(d,n.bind(r,t),this);return l}}function l(e,t,n,i){var o=s(n),r=t[0],a=t[1],d=t[2];o[r]={type:e,ev:r,cb:a,ctx:d};var l=i||n.getModel();l&&n["on"===e?"listenTo":"listenToOnce"](l,r,a,d)}function s(e){var t=v("__modelEvents",e);return t||(t={},m({__modelEvents:t},e)),t}function u(e){for(var t,n=0;n<e.length;n++)t=e[n],"true"===t?t=!0:"false"===t?t=!1:t.match(/^[0-9]+$/)?t=parseInt(t):t.match(/^[0-9]+\.[0-9]+/)&&(t=parseFloat(t)),e[n]=t;return e}var c=t.xhrEventName,f=t.xhrCompleteEventName,h=t.xhrModelLoadingAttribute,v=e.mixins.getState,m=e.mixins.setState;t.input=t.input||{};{var g=t.input.getModelValue=function(e){return a(e,function(e,t){return t.get(e)})};t.input.setModelValue=function(e,t,n){return a(e,function(e,i){return i.set(e,t,n)})}}if(e.mixins.add("modelAware",{getModel:function(e){return e=e||this.props,v("model",this)||v("collection",this)||e.model||e.collection},setModel:function(e,t){var i=this.getModel(),o=s(this);n.each(o,function(t){this.modelOff(t.ev,t.cb,t.ctx,i),l(t.type,[t.ev,t.cb,t.ctx],this,e)},this),t!==!0&&m("model",e)}},"state"),e.mixins.add("modelPopulate",{modelPopulate:function(){var e,i,o,a;n.each(arguments,function(r){r instanceof t.Model||r===!1?a=r:n.isArray(r)?e=r:n.isFunction(r)?i=r:o=r}),n.isUndefined(a)&&this.getModel&&(a=this.getModel());var d={};e||(e=n.map(this.refs,function(e){return e}));var l={};if(n.each(e,function(e){if(e.getValue){var t=r(e);if(t){var i=e.getValue();d[t]=i}}else if(e.modelPopulate&&e.getModel){if(!a)return;var s=e.getModel();if(s){var u=e.modelPopulate(o,!1),c=l[s.cid]||{};n.extend(c,u),l[s.cid]={model:s,attr:c}}}}),a){var s=!0,u=l[a.cid];u||(u={model:a,attr:{}}),n.extend(u.attr,d),l[a.cid]=u;var c=n.defaults({validate:!0},o);n.each(l,function(e){var t=!e.model._validate(e.attr,c);s=!t&&s}),s&&(o=n.defaults({validate:!1},o),n.each(l,function(e){e.model.set(e.attr,o)})),i&&s&&i.call(this,a)}return d}},"modelAware"),e.mixins.add("modelValidator",{modelValidate:function(e,t){var n=this.getModel();return n&&n.validate?this.modelIndexErrors(n.validate(e,t))||!1:void 0}},"modelAware","modelIndexErrors"),e.mixins.add("modelEventAware",{getInitialState:function(){var e=this.getModel();return e&&(e.off&&e.on||(console.error("the model does not implement on/off functions - you will see problems"),console.log(e))),{}},componentWillReceiveProps:function(e){var t=this.getModel(),n=this.getModel(e);t!==n&&this.setModel(n,!0)},modelOn:function(){l("on",arguments,this)},modelOnce:function(){l("once",arguments,this)},modelOff:function(e,t,n,i){var r=s(this);delete r[e],this.stopListening(o(i),e,t,n)}},"modelAware","listen"),e.mixins.add("modelChangeAware",{getInitialState:function(){return n.each(["change","reset","add","remove","sort"],function(e){this.modelOn(e,function(){this.deferUpdate()})},this),null}},"modelEventAware","deferUpdate"),e.mixins.add("modelXHRAware",{getInitialState:function(){this.modelOn(c,function(e,t){m({loading:!0},this);var n=this.getModel();t.on("success",function(){m({loading:n[h]},this)},this),t.on("error",function(e){m({loading:n[h],error:e},this)},this)});var e=this.getModel();return{loading:e&&e[h]}},componentDidMount:function(){var e=this.state,t=this.getModel();if(t){var n=t[h];n?(this.modelOnce(f,function(){m({loading:!1},this)}),e.loading||m({loading:!0},this)):e.loading&&m({loading:!1},this)}}},"modelEventAware"),e.mixins.add("modelInvalidAware",{getInitialState:function(){var e=r(this);return e&&this.modelOn("invalid",function(t,n){var i=this.modelIndexErrors(n)||{},o=i&&i[e];o&&m({invalid:o},this)}),{}}},"modelIndexErrors","modelEventAware"),e.mixins.add("modelIndexErrors",{modelIndexErrors:function(e){if(Array.isArray(e)){var t={};return n.each(e,function(e){for(var n in e)t[n]=e[n]}),t}return e}}),e.mixins.add("modelLoadOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){e=d(e||"loadOn",this,c+":{key}",function(e){var t=this.getModel();m({loading:t[h]},this),e.on("complete",function(){m({loading:!1},this)},this)});var t=this.getModel();if(t){var n,i=t.loading;if(i)for(var o=function(){m({loading:!1},this)},r=0;r<i.length;r++){var a=e.indexOf(i[r].method);if(a>=0)return n=e[a],i[r].on("complete",o,this),{loading:t[h]}}}return{}},loadWhile:function(e){function t(t){var i=e[t];e[t]=function(){m({loading:!1},n),i&&i.apply(this,arguments)}}e=e||{};var n=this;return t("error"),t("success"),m({loading:!0},this),e}}},"modelEventAware"),e.mixins.add("modelUpdateOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){d(e||"updateOn",this,"{key}",function(){this.deferUpdate()})}}},"modelEventAware","deferUpdate"),e.events){e.events.mixin=e.events.mixin||t.Events;var p=/^model(\[.+\])?$/;e.events.handle(p,function(e,t){return{on:function(){this.modelOn(e.path,t)},off:function(){}}});var M=e.events.specials;if(M){var x=["memoize","delay","defer","throttle","debounce","once","after","before"];n.each(x,function(e){M[e]=M[e]||function(t,i){return i=u(i),i.splice(0,0,t),n[e].apply(n,i)}})}}var y=function(t,i,o,r){return e.createClass(n.extend({mixins:["modelAware"],render:function(){var r={},a=g(this);return o?r.defaultChecked=a:r.defaultValue=a,e.DOM[t](n.extend(r,i,this.props),this.props.children)},getValue:function(){if(this.isMounted()){if(o){var e=this.getDOMNode();return e.checked&&(e.value||!0)||!1}return $(this.getDOMNode()).val()}},getDOMValue:function(){return this.isMounted()?$(this.getDOMNode()).val():void 0}},r))};t.input=t.input||{},n.defaults(t.input,{Text:y("input",{type:"text"}),TextArea:y("textarea"),Select:y("select",void 0,void 0),CheckBox:y("input",{type:"checkbox"},!0),RadioGroup:e.createClass({render:function(){var t=this.props;return t.ref="input",e.DOM[t.tag||"span"](t,t.children)},componentDidMount:function(){var e=g(this);if(e){var t='input[value="'+e.replace('"','\\"')+'"]',n=$(this.getDOMNode()).find(t);n.attr("checked","checked")}},getValue:function(){if(this.isMounted())for(var e='input[type="radio"]',t=$(this.getDOMNode()).find(e),n=0;n<t.length;n++)if(t[n].checked)return t[n].value},getDOMValue:function(){if(this.isMounted()){return $(this.getDOMNode()).val()}}})})});