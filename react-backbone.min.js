/*!
 * https://github.com/jhudson8/react-backbone v0.9.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define(["react","backbone","underscore"],e):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(t,n){e(t,n,require("underscore"))}:e(React,Backbone,_)}(function(e,t,n){function i(e){return e?n.isArray(e)?e:[e]:void 0}function o(e){return e.props.key||e.props.ref}function a(e,t,o,a){var r,d,l=Array.isArray(e)?e:i(t.props[e]);if(l){for(var s=0;s<l.length;s++)r=l[s],d=o.replace("{key}",r),t.modelOn(d,n.bind(a,t),this);return l}}function r(e,t){var i,o=this;if(t=n.extend({type:e},t),this.state?(i=this.state.__modelEvents,o=this.state):i=this.__modelEvents,i||(i=o.__modelEvents=[]),t.context=t.context||this,i.push(t),this.isMounted()){var a=t.model||this.getModel();a&&a[t.type](t.event,t.callback,t.context)}}function d(e){for(var t,n=0;n<e.length;n++)t=e[n],"true"===t?t=!0:"false"===t?t=!1:t.match(/^[0-9]+$/)?t=parseInt(t):t.match(/^[0-9]+\.[0-9]+/)&&(t=parseFloat(t)),e[n]=t;return e}if(e.mixins.add("modelAware",{getModel:function(){return this.props.model},setModel:function(e){this._modelUnbindAll&&this._modelUnbindAll(!0),this.setProps({model:e}),this._modelBindAll&&this.isMounted()&&this._modelBindAll()}}),e.mixins.add("modelValueAware",function(e){return{getModelValue:function(){e=e||o(this);var t=this.getModel();return t&&e?t.get(e):void 0},setModelValue:function(t,n){e=e||o(this);var i=this.getModel();return i=this.getModel(),i&&e?i.set(e,t,n):void 0}}},"modelAware"),e.mixins.add("modelPopulate",{modelPopulate:function(e,t,i){n.isFunction(e)&&(i=t,t=e,e=void 0);var a={};if(e||(e=n.map(this.refs,function(e){return e})),n.each(e,function(e){if(e.getUIModelValue){var t=o(e),n=e.getUIModelValue();a[t]=n}}),t&&this.getModel){var r=this.getModel();r&&r.set(a,i||{validate:!0})&&t.call(this,r)}return a}},"modelAware"),e.mixins.add("modelValidator",{modelValidate:function(e,t){var n=this.getModel();return n&&n.validate?this.modelIndexErrors(n.validate(e,t))||!1:void 0}},"modelAware","modelIndexErrors"),e.mixins.add("modelEventAware",{getInitialState:function(){return{}},modelOn:function(e,t){var n=t?{event:e,callback:t}:e;r.call(this,"on",n)},modelOnce:function(e,t){var n=t?{event:e,callback:t}:e;r.call(this,"once",n)},modelOff:function(e,t){var n=t?{event:e,callback:t}:e,i=this.state.__modelEvents;if(i)for(var o,a=0;a<i.length;a++)if(o=i[a],o.event===n.event&&o.model===n.model&&o.callback===n.callback){var r=n.model||this.getModel();r&&r.off(n.event,n.callback,n.context||this),i.splice(a,1)}},_modelBindAll:function(){if(this.state){var e=this.__modelEvents;if(e&&(delete this.__modelEvents,this.state.__modelEvents=e),e=this.state.__modelEvents){var t=this.getModel();n.each(e,function(e){var n=e.model||t;n&&n[e.type](e.event,e.callback,e.context)})}}},_modelUnbindAll:function(e){if(this.state){var t=this.state.__modelEvents,i=this.getModel();t&&(n.each(t,function(e){var t=e.model||i;t&&t.off(e.event,e.callback,e.context)}),e||(this.state.__modelEvents=[]))}},componentDidMount:function(){this._modelUnbindAll(!0),this._modelBindAll(!0)},componentWillUnmount:function(){this._modelUnbindAll(!0)}},"modelAware"),e.mixins.add("modelChangeAware",{getInitialState:function(){return n.each(["change","reset","add","remove","sort"],function(e){this.modelOn(e,function(){this.deferUpdate()})},this),null}},"modelEventAware","deferUpdate"),e.mixins.add("modelAsyncAware",{getInitialState:function(){this.modelOn("async",function(e,t){this.setState({loading:!0});var n=this.getModel();t.on("success",function(){this.isMounted()&&this.setState({loading:!!n.isLoading()})},this),t.on("error",function(e){this.isMounted()&&this.setState({loading:!!n.isLoading(),error:e})},this)});var e=this.getModel();return e&&e.isLoading()?{loading:!0}:{}},componentDidMount:function(){var e=this.state,t=this.getModel();t&&(t.isLoading()?(this.modelOnce("async:load-complete",function(){this.setState({loading:!1})}),e.loading||this.setState({loading:!0})):e.loading&&this.setState({loading:!1}))}},"modelEventAware"),e.mixins.add("modelInvalidAware",{getInitialState:function(){var e=o(this);return e&&this.modelOn("invalid",function(t,n){n=this.modelIndexErrors(n)||{};var i=n[e];i&&this.setState({error:i})}),{}}},"modelIndexErrors","modelEventAware"),e.mixins.add("modelIndexErrors",{modelIndexErrors:function(e){if(Array.isArray(e)){var t={};return n.each(e,function(e){for(var n in e)t[n]=e[n]}),t}return e}}),e.mixins.add("modelLoadOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){e=a(e||"loadOn",this,"async:{key}",function(e){this.setState({loading:!0}),e.on("complete",function(){this.isMounted()&&this.setState({loading:!1})},this)});var t=this.getModel();if(t){var n,i=t.isLoading();if(i)for(var o=function(){this.isMounted()&&this.setState({loading:!1})},r=0;r<i.length;r++){var d=e.indexOf(i[r].method);if(d>=0)return n=e[d],i[r].on("complete",o,this),{loading:!0}}}return{}},loadWhile:function(e){function t(t){var i=e[t];e[t]=function(){n.setState({loading:!1}),i&&i.apply(this,arguments)}}e=e||{};var n=this;return t("error"),t("success"),this.setState({loading:!0}),e}}},"modelEventAware"),e.mixins.add("modelUpdateOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){a(e||"updateOn",this,"{key}",function(){this.deferUpdate()})}}},"modelEventAware","deferUpdate"),e.events){e.events.mixin=e.events.mixin||t.Events;var l=/^model(\[.+\])?$/;e.events.handle(l,function(e,t){var n=e.key.match(l),i=n[1]&&n[1].substring(1,n[1].length-1),o=i&&(this.props[i]||this.refs[i]);if(!o&&i)throw new Error('no model found with "'+i+'"');var a={model:o,event:e.path,callback:t};return{on:function(){this.modelOn(a)},off:function(){}}});var s=e.events.specials;if(s){var c=["memoize","delay","defer","throttle","debounce","once"];n.each(c,function(e){s[e]=s[e]||function(t,i){return i=d(i),i.splice(0,0,t),n[e].apply(n,i)}})}}var u=function(t,i,o,a){return e.createClass(n.extend({mixins:["modelValueAware"],render:function(){var a={},r=this.getModelValue();return o?a.defaultChecked=r:a.defaultValue=r,e.DOM[t](n.extend(a,i,this.props),this.props.children)},getUIModelValue:function(){if(this.isMounted()){if(!o)return $(this.getDOMNode()).val();var e=this.getDOMNode();if(e.checked)return e.value||!0}}},a))};t.input=t.input||{},n.defaults(t.input,{Text:u("input",{type:"text"}),TextArea:u("textarea"),Select:u("select",void 0,void 0),CheckBox:u("input",{type:"checkbox"},!0),RadioGroup:e.createClass({mixins:["modelValueAware"],render:function(){var t=this.props;return e.DOM[t.tag||"span"](t,t.children)},componentDidMount:function(){var e=this.getModelValue();if(e){var t='input[value="'+e.replace('"','\\"')+'"]',n=$(this.getDOMNode()).find(t);n.attr("checked","checked")}},getUIModelValue:function(){if(this.isMounted())for(var e='input[type="radio"]',t=$(this.getDOMNode()).find(e),n=0;n<t.length;n++)if(t[n].checked)return t[n].value}})})});