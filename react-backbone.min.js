/*!
 * https://github.com/jhudson8/react-backbone v0.1.2;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define(["react","backbone","underscore"],e):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(t,n){e(t,n,require("underscore"))}:e(React,Backbone,_)}(function(e,t,n){function i(e){return e?n.isArray(e)?e:[e]:void 0}function o(e,t,o,d){var s,l,r=i(t.props[e]);if(r){for(var a=0;a<r.length;a++)s=r[a],l=o.replace("{key}",s),t.modelOn(l,n.bind(d,t),this);return r}}function d(e,t,n,i){if(i=i||this,this.__modelEvents||(this.__modelEvents={}),this.__modelEvents[t]={type:e,callback:n,context:i},this.isMounted()){var o=this.getModel();o&&o[e](t,n,i)}}e.mixins.add("modelAccessor",{getModel:function(){return this.model||this.props.model},setModel:function(e){this._modelUnbindAll&&this._modelUnbindAll(!0),this.model=e,this._modelBindAll&&this.isMounted()&&this._modelBindAll()}}),e.mixins.add("modelValueAccessor",{getModelValue:function(){var e=this.props.key,t=this.getModel();return t&&e?t.get(e):void 0},setModelValue:function(e,t){var n=this.props.key,i=this.getModel();return i&&n?i.set(n,e,t):void 0}},"modelAccessor"),e.mixins.add("modelEventBinder",{modelOn:function(e,t,n){d.call(this,"on",e,t,n)},modelOnce:function(e,t,n){d.call(this,"once",e,t,n)},modelOff:function(e,t,n){if(this.__modelEvents){var i=this.__modelEvents[e],o=this.getModel();o&&i?o.off(e,t,n||this):i&&delete this.__modelEvents[e]}},_modelBindAll:function(){if(this.__modelEvents){var e=this.getModel();e&&n.each(this.__modelEvents,function(t,n){e[t.type](n,t.callback,t.context)})}},_modelUnbindAll:function(e){if(this.__modelEvents){var t=this.getModel();t&&n.each(this.__modelEvents,function(e,n){t.off(n,e.callback,e.context)}),e||delete this.__modelEvents}},componentDidMount:function(){this._modelUnbindAll(!0),this._modelBindAll(!0)},componentWillUnmount:function(){this._modelUnbindAll(!0)}},"modelAccessor"),e.mixins.add("modelChangeListener",{getInitialState:function(){return n.each(["change","reset","add","remove","sort"],function(e){this.modelOn(e,function(){this.forceUpdate()})},this),null}},"modelEventBinder"),e.mixins.add("modelAsyncListener",{getInitialState:function(){this.modelOn("async",function(e,t){this.setState({loading:!0});var n=this.getModel();t.on("success",function(){this.isMounted()&&this.setState({loading:!!n.isLoading()})},this),t.on("error",function(e){this.isMounted()&&this.setState({loading:!!n.isLoading(),error:e})},this)});var e=this.getModel();return e&&e.isLoading()?{loading:!0}:{}},componentDidMount:function(){var e=this.state,t=this.getModel();t&&(t.isLoading()?(this.modelOnce("async:load-complete",function(){this.setState({loading:!1})}),e.loading||this.setState({loading:!0})):e.loading&&this.setState({loading:!1}))}},"modelEventBinder"),e.mixins.add("modelFieldValidator",{getInitialState:function(){var e=this.props.key;return e&&this.modelOn("invalid",function(t,n){n=this.modelIndexErrors(n)||{};var i=n[e];i&&this.setState({error:i})}),null}},"modelIndexErrors","modelEventBinder"),e.mixins.add("modelIndexErrors",{modelIndexErrors:function(e){if(Array.isArray(e)){var t={};return n.each(e,function(e){for(var n in e)t[n]=e[n]}),t}return e}}),e.mixins.add("modelLoadOn",{getInitialState:function(){var e=o("loadOn",this,"async:{key}",function(e){this.setState({loading:!0}),e.on("complete",function(){this.setState({loading:!1})},this)}),t=this.getModel();if(t){var n,i=t.isLoading();if(i)for(var d=0;d<i.length;d++){var s=e.indexOf(i[d].method);if(s>=0)return n=e[s],i[d].on("complete",function(){this.isMounted()&&this.setState({loading:!1})},this),{loading:!0}}}return null}},"modelEventBinder"),e.mixins.add("modelUpdateOn",{getInitialState:function(){o("updateOn",this,"{key}",function(){this.forceUpdate()})}},"modelEventBinder"),e.events&&(e.events.mixin=e.events.mixin||t.Events,e.events.handle("model",function(e,t){return{on:function(){this.modelOn(e.path,t)},off:function(){}}}))});