/*!
 * https://github.com/jhudson8/react-backbone v0.2.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(t){"function"==typeof define&&define.amd?define(["react","backbone","underscore"],t):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(e,n){t(e,n,require("underscore"))}:t(React,Backbone,_)}(function(t,e,n){function i(t){return t?n.isArray(t)?t:[t]:void 0}function o(t,e,o,s){var d,l,a=i(e.props[t]);if(a){for(var r=0;r<a.length;r++)d=a[r],l=o.replace("{key}",d),e.modelOn(l,n.bind(s,e),this);return a}}function s(t,e,n,i){i=i||this;var o,s=this;if(this.state?(o=this.state.__modelEvents,s=this.state):o=this.__modelEvents,o||(o=s.__modelEvents={}),o[e]={type:t,callback:n,context:i},this.isMounted()){var d=this.getModel();d&&d[t](e,n,i)}}t.mixins.add("modelAccessor",{getModel:function(){return this.props.model},setModel:function(t){this._modelUnbindAll&&this._modelUnbindAll(!0),this.setProps({model:t}),this._modelBindAll&&this.isMounted()&&this._modelBindAll()}}),t.mixins.add("modelValueAccessor",{getModelValue:function(){var t=this.props.key,e=this.getModel();return e&&t?e.get(t):void 0},setModelValue:function(t,e){var n=this.props.key,i=this.getModel();return i&&n?i.set(n,t,e):void 0}},"modelAccessor"),t.mixins.add("modelEventBinder",{getInitialState:function(){return{}},modelOn:function(t,e,n){s.call(this,"on",t,e,n)},modelOnce:function(t,e,n){s.call(this,"once",t,e,n)},modelOff:function(t,e,n){var i=this.state.__modelEvents;if(i){var o=i[t],s=this.getModel();s&&o?s.off(t,e,n||this):o&&delete i[t]}},_modelBindAll:function(){var t=this.__modelEvents;if(t&&(delete this.__modelEvents,this.state.__modelEvents=t),t=this.state.__modelEvents){var e=this.getModel();e&&n.each(t,function(t,n){e[t.type](n,t.callback,t.context)})}},_modelUnbindAll:function(t){var e=this.state.__modelEvents;if(e){var i=this.getModel();i&&n.each(e,function(t,e){i.off(e,t.callback,t.context)}),t||delete this.state.__modelEvents}},componentDidMount:function(){this._modelUnbindAll(!0),this._modelBindAll(!0)},componentWillUnmount:function(){this._modelUnbindAll(!0)}},"modelAccessor"),t.mixins.add("modelChangeListener",{getInitialState:function(){return n.each(["change","reset","add","remove","sort"],function(t){this.modelOn(t,function(){this.forceUpdate()})},this),null}},"modelEventBinder"),t.mixins.add("modelAsyncListener",{getInitialState:function(){this.modelOn("async",function(t,e){this.setState({loading:!0});var n=this.getModel();e.on("success",function(){this.isMounted()&&this.setState({loading:!!n.isLoading()})},this),e.on("error",function(t){this.isMounted()&&this.setState({loading:!!n.isLoading(),error:t})},this)});var t=this.getModel();return t&&t.isLoading()?{loading:!0}:{}},componentDidMount:function(){var t=this.state,e=this.getModel();e&&(e.isLoading()?(this.modelOnce("async:load-complete",function(){this.setState({loading:!1})}),t.loading||this.setState({loading:!0})):t.loading&&this.setState({loading:!1}))}},"modelEventBinder"),t.mixins.add("modelFieldValidator",{getInitialState:function(){var t=this.props.key;return t&&this.modelOn("invalid",function(e,n){n=this.modelIndexErrors(n)||{};var i=n[t];i&&this.setState({error:i})}),{}}},"modelIndexErrors","modelEventBinder"),t.mixins.add("modelIndexErrors",{modelIndexErrors:function(t){if(Array.isArray(t)){var e={};return n.each(t,function(t){for(var n in t)e[n]=t[n]}),e}return t}}),t.mixins.add("modelLoadOn",{getInitialState:function(){var t=o("loadOn",this,"async:{key}",function(t){this.setState({loading:!0}),t.on("complete",function(){this.isMounted()&&this.setState({loading:!1})},this)}),e=this.getModel();if(e){var n,i=e.isLoading();if(i)for(var s=function(){this.isMounted()&&this.setState({loading:!1})},d=0;d<i.length;d++){var l=t.indexOf(i[d].method);if(l>=0)return n=t[l],i[d].on("complete",s,this),{loading:!0}}}return{}}},"modelEventBinder"),t.mixins.add("modelUpdateOn",{getInitialState:function(){o("updateOn",this,"{key}",function(){this.forceUpdate()})},updateOnModelEvent:function(){function t(){this.forceUpdate()}n.each(arguments,function(e){this.modelOn(e,t)},this)}},"modelEventBinder"),t.events&&(t.events.mixin=t.events.mixin||e.Events,t.events.handle("model",function(t,e){return{on:function(){this.modelOn(t.path,e)},off:function(){}}}))});