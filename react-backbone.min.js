/*!
 * https://github.com/jhudson8/react-backbone v0.10.2;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define(["react","backbone","underscore"],e):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(t,n){e(t,n,require("underscore"))}:e(React,Backbone,_)}(function(e,t,n){function i(e,t){t.isMounted()?t.setState(e):t.state?n.extend(t.state,e):t.__react_backbone_state=n.extend(t.__react_backbone_state||{},e)}function o(e,t){var n=t.state,i=t.__react_backbone_state;return n&&n[e]||i&&i[e]}function a(e){return e?n.isArray(e)?e:[e]:void 0}function r(e){return e.props.key||e.props.ref}function l(e,t,i,o){var r,l,d=Array.isArray(e)?e:a(t.props[e]);if(d){for(var s=0;s<d.length;s++)r=d[s],l=i.replace("{key}",r),t.modelOn(l,n.bind(o,t),this);return d}}function d(e,t){t=n.extend({type:e},t);var a=o("__modelEvents",this);if(a||(a=[],i({__modelEvents:a},this)),t.context=t.context||this,a.push(t),this.isMounted()){var r=t.model||this.getModel();r&&r[t.type](t.event,t.callback,t.context)}}function s(e){for(var t,n=0;n<e.length;n++)t=e[n],"true"===t?t=!0:"false"===t?t=!1:t.match(/^[0-9]+$/)?t=parseInt(t):t.match(/^[0-9]+\.[0-9]+/)&&(t=parseFloat(t)),e[n]=t;return e}var c=t.xhrEventName,u=t.xhrCompleteEventName,h=t.xhrModelLoadingAttribute;if(e.mixins.add("modelAware",{componentWillMount:function(){var e=this.__react_backbone_state;e&&(this.state=n.extend(this.state||{},e),delete this.__react_backbone_state)},getModel:function(){return o("model",this)||o("collection",this)||this.props.model||this.props.collection},setModel:function(e){this._modelUnbindAll&&this._modelUnbindAll(!0),i({model:e},this),this._modelBindAll&&this.isMounted()&&this._modelBindAll()}}),e.mixins.add("modelValueAware",function(e){return{getModelValue:function(){e=e||r(this);var t=this.getModel();return t&&e?t.get(e):void 0},setModelValue:function(t,n){e=e||r(this);var i=this.getModel();return i=this.getModel(),i&&e?i.set(e,t,n):void 0}}},"modelAware"),e.mixins.add("modelPopulate",{modelPopulate:function(e,t,i){n.isFunction(e)&&(i=t,t=e,e=void 0);var o={};if(e||(e=n.map(this.refs,function(e){return e})),n.each(e,function(e){if(e.getUIModelValue){var t=r(e),n=e.getUIModelValue();o[t]=n}}),t&&this.getModel){var a=this.getModel();a&&a.set(o,i||{validate:!0})&&t.call(this,a)}return o}},"modelAware"),e.mixins.add("modelValidator",{modelValidate:function(e,t){var n=this.getModel();return n&&n.validate?this.modelIndexErrors(n.validate(e,t))||!1:void 0}},"modelAware","modelIndexErrors"),e.mixins.add("modelEventAware",{getInitialState:function(){return{}},modelOn:function(e,t){var n=t?{event:e,callback:t}:e;d.call(this,"on",n)},modelOnce:function(e,t){var n=t?{event:e,callback:t}:e;d.call(this,"once",n)},modelOff:function(e,t){var n=t?{event:e,callback:t}:e,i=this.state.__modelEvents;if(i)for(var o,a=0;a<i.length;a++)if(o=i[a],o.event===n.event&&o.model===n.model&&o.callback===n.callback){var r=n.model||this.getModel();r&&r.off(n.event,n.callback,n.context||this),i.splice(a,1)}},_modelBindAll:function(){var e=o("__modelEvents",this);if(e){var t=this.getModel();n.each(e,function(e){var n=e.model||t;n&&n[e.type](e.event,e.callback,e.context)})}},_modelUnbindAll:function(e){var t=o("__modelEvents",this);if(t){var a=this.getModel();n.each(t,function(e){var t=e.model||a;t&&t.off(e.event,e.callback,e.context)}),e||i({__modelEvents:[]},this)}},componentDidMount:function(){this._modelUnbindAll(!0),this._modelBindAll(!0)},componentWillUnmount:function(){this._modelUnbindAll(!0)}},"modelAware"),e.mixins.add("modelChangeAware",{getInitialState:function(){return n.each(["change","reset","add","remove","sort"],function(e){this.modelOn(e,function(){this.deferUpdate()})},this),null}},"modelEventAware","deferUpdate"),e.mixins.add("modelXHRAware",{getInitialState:function(){this.modelOn(c,function(e,t){i({loading:!0},this);var n=this.getModel();t.on("success",function(){i({loading:n[h]},this)},this),t.on("error",function(e){i({loading:n[h],error:e},this)},this)});var e=this.getModel();return{loading:e&&e[h]}},componentDidMount:function(){var e=this.state,t=this.getModel();if(t){var n=t[h];n?(this.modelOnce(u,function(){i({loading:!1},this)}),e.loading||i({loading:!0},this)):e.loading&&i({loading:!1},this)}}},"modelEventAware"),e.mixins.add("modelInvalidAware",{getInitialState:function(){var e=r(this);return e&&this.modelOn("invalid",function(t,n){n=this.modelIndexErrors(n)||{};var o=n[e];o&&i({invalid:o},this)}),{}}},"modelIndexErrors","modelEventAware"),e.mixins.add("modelIndexErrors",{modelIndexErrors:function(e){if(Array.isArray(e)){var t={};return n.each(e,function(e){for(var n in e)t[n]=e[n]}),t}return e}}),e.mixins.add("modelLoadOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){e=l(e||"loadOn",this,c+":{key}",function(e){var t=this.getModel();i({loading:t[h]},this),e.on("complete",function(){i({loading:!1},this)},this)});var t=this.getModel();if(t){var n,o=t.loading;if(o)for(var a=function(){i({loading:!1},this)},r=0;r<o.length;r++){var d=e.indexOf(o[r].method);if(d>=0)return n=e[d],o[r].on("complete",a,this),{loading:t[h]}}}return{}},loadWhile:function(e){function t(t){var o=e[t];e[t]=function(){i({loading:!1},n),o&&o.apply(this,arguments)}}e=e||{};var n=this;return t("error"),t("success"),i({loading:!0},this),e}}},"modelEventAware"),e.mixins.add("modelUpdateOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){l(e||"updateOn",this,"{key}",function(){this.deferUpdate()})}}},"modelEventAware","deferUpdate"),e.events){e.events.mixin=e.events.mixin||t.Events;var f=/^model(\[.+\])?$/;e.events.handle(f,function(e,t){var n=e.key.match(f),i=n[1]&&n[1].substring(1,n[1].length-1),o=i&&(this.props[i]||this.refs[i]);if(!o&&i)throw new Error('no model found with "'+i+'"');var a={model:o,event:e.path,callback:t};return{on:function(){this.modelOn(a)},off:function(){}}});var m=e.events.specials;if(m){var v=["memoize","delay","defer","throttle","debounce","once"];n.each(v,function(e){m[e]=m[e]||function(t,i){return i=s(i),i.splice(0,0,t),n[e].apply(n,i)}})}}var p=function(t,i,o,a){return e.createClass(n.extend({mixins:["modelValueAware"],render:function(){var a={},r=this.getModelValue();return o?a.defaultChecked=r:a.defaultValue=r,e.DOM[t](n.extend(a,i,this.props),this.props.children)},getUIModelValue:function(){if(this.isMounted()){if(!o)return $(this.getDOMNode()).val();var e=this.getDOMNode();if(e.checked)return e.value||!0}}},a))};t.input=t.input||{},n.defaults(t.input,{Text:p("input",{type:"text"}),TextArea:p("textarea"),Select:p("select",void 0,void 0),CheckBox:p("input",{type:"checkbox"},!0),RadioGroup:e.createClass({mixins:["modelValueAware"],render:function(){var t=this.props;return e.DOM[t.tag||"span"](t,t.children)},componentDidMount:function(){var e=this.getModelValue();if(e){var t='input[value="'+e.replace('"','\\"')+'"]',n=$(this.getDOMNode()).find(t);n.attr("checked","checked")}},getUIModelValue:function(){if(this.isMounted())for(var e='input[type="radio"]',t=$(this.getDOMNode()).find(e),n=0;n<t.length;n++)if(t[n].checked)return t[n].value}})})});